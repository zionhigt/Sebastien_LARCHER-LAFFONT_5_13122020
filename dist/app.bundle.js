(()=>{"use strict";let e=0;const t={add:{text:" à été ajouté a votre panier !",bg:"bg-success"},delete:{text:" à été supprimé de votre panier !",bg:"bg-danger"},already:{text:" est déjà dans votre panier",bg:"bg-info"}};function n(n,o){let c=document.querySelector("#alertBox"),i=document.importNode(c.content,!0),d=i.querySelector("#alertContainer");r(d,""+e),d.classList.add("show",t[n].bg);let l=i.querySelector("#alertName");r(l,""+e),l.innerHTML=o;let a=i.querySelector("#alertMessage");return r(a,""+e),a.innerHTML=t[n].text,e++,e>50&&(e=0),d.style.zIndex=2*e+1e4+"",setTimeout((function(){d.classList.add("d-none")}),4500),i}function r(e,t){const n=e.id;e.setAttribute("id",n+"_"+t)}const o=["Valider vos informations","Ma commande me convient","Payer","","Fermer"],c=["Fermer","Modifier vos informations","Ma commande",""];let i=document.getElementById("nextStep"),d=document.getElementById("previousStep"),l=document.getElementById("stepContainer");function a(e){!function(e){let t=document.getElementById("progressbar"),n=-1;4==e&&(e=3);for(let r of t.children)n++,n==e?r.classList.add("active"):r.classList.remove("active")}(e),function(e){let t=o[e],n=c[e];i.innerHTML=t,d.innerHTML=n}(e);let t=-1;for(let n of l.children)t++,n.style.display=t==e?"block":"none"}let s=document.getElementById("nextStep");function u(e){$("#submitOrder").modal("hide"),$("#cartView").modal("hide"),E()}let m=document.getElementById("previousStep"),p=document.getElementById("nextStep"),y={firstName:"",lastName:"",address:"",city:"",email:""};function f(){1==function(){const e=document.getElementById("firstName"),t=document.getElementById("lastName"),n=document.getElementById("address"),r=document.getElementById("city"),o=document.getElementById("email");let c=[e,t,n,r,o],i=1;y.firstName=e.value,y.lastName=t.value,y.address=n.value,y.city=r.value,y.email=o.value;for(let e of c)""!=e.value&&"string"==typeof e.value||(e.classList.add("unvalable","bg-warning"),i=0),e.addEventListener("focus",(function(e){e.target.classList.remove("unvalable","bg-warning")}));return i}()&&C()}function v(){$("#submitOrder").modal("hide")}function E(){a(0),p.classList.add("d-block"),m.classList.add("d-block"),m.removeEventListener("click",q),p.removeEventListener("click",u),p.removeEventListener("click",k),p.addEventListener("click",f),m.addEventListener("click",v)}function L(){let e=[];for(let t of N)e.push(t._id);return e}let g=document.getElementById("nextStep"),h=document.getElementById("previousStep"),I=document.getElementById("mainPrice");function b(){a(3),g.classList.add("d-none"),h.classList.add("d-none"),g.classList.remove("d-block"),h.classList.remove("d-block"),async function(){let e=JSON.stringify({contact:y,products:L()});return(await fetch("https://orinoco-cameras.herokuapp.com/api/cameras/order",{method:"POST",body:e,headers:{"Content-Type":"application/json"}})).json()}().then((function(e){g.classList.add("d-block"),function(e){a(4),document.getElementById("orderNumber").value=e.orderId,N=[],A=[],_=[],P=0,X(),O(),s.removeEventListener("click",b),s.addEventListener("click",u),setTimeout((function(){document.querySelector("body").classList.add("modal-open")}),500)}(e)})).catch((function(e){console.log("Erreur lors de la requête : "+e)}))}function w(){C()}function S(){I.innerHTML=P+"€"}let T=document.querySelector("#cvView tbody"),B=document.getElementById("nextStep"),x=document.getElementById("previousStep"),M=document.getElementById("priceTotal");function k(){S(),a(2),g.removeEventListener("click",k),g.removeEventListener("click",u),h.removeEventListener("click",q),g.addEventListener("click",b),h.addEventListener("click",w)}function q(){E()}function C(){H(),a(1),B.removeEventListener("click",f),B.removeEventListener("click",b),x.removeEventListener("click",w),x.removeEventListener("click",v),B.addEventListener("click",k),x.addEventListener("click",q)}function H(){let e=N;T.innerHTML="",M.innerHTML=P+"€";for(let t in e){let n=document.createElement("tr"),r=document.createElement("td");r.innerHTML=_[t];let o=document.createElement("td");o.innerHTML=e[t].name;let c=document.createElement("td");c.innerHTML=e[t].price/100+"€";let i=document.createElement("td");i.innerHTML=_[t]*e[t].price/100+"€",n.appendChild(r),n.appendChild(o),n.appendChild(c),n.appendChild(i),T.appendChild(n)}S()}let N=[],A=[],_=[],P=0;function O(){let e=document.getElementById("cartProducts");const t=document.querySelector("#validateOrder");e.innerHTML="";let n=document.getElementById("cardCartView");if(document.getElementById("howCountCart").innerHTML=N.length,N.length>0){for(let t in N){let r=document.importNode(n.content,!0),o=r.getElementById("cardCartName");o.innerHTML=N[t].name,o.setAttribute("id","cardCartName_"+t);let c=r.getElementById("cardCartDescription");c.innerHTML=N[t].description,c.setAttribute("id","cardCartDescription_"+t);let i=r.getElementById("quantityIncrement");i.setAttribute("id","quantityIncrement_"+t),N.indexOf(N[t])>=0&&(i.value=A[N.indexOf(N[t])]/N[t].price*100);let d=r.getElementById("cardCartPrice");d.setAttribute("id","cardCartPrice_"+t),d.innerHTML="Sous-Total : "+N[t].price*i.value/100+" €",r.getElementById("removeToCart").addEventListener("click",(function(e){e.preventDefault(),V(N[t]),O()})),i.addEventListener("change",(function(e){for(;i.value<=0;)i.value=1;d.innerHTML="Sous-Total : "+N[t].price*i.value/100+" €";let n=N.indexOf(N[t]);A[n]=parseInt(N[t].price*i.value)/100,_[n]=parseInt(i.value),X()})),e.appendChild(r)}t.disabled=!1}else document.createElement("span"),e.innerHTML='<span class="font-weight-bold text-center bg-dark text-orinoco my-5 d-block">Votre panier est vide!</span>',t.disabled=!0,$("#cartView").modal("hide");t.addEventListener("click",H)}function V(e){let t=N.indexOf(e);t>-1&&(N.splice(t,1),A.splice(t,1),_.splice(t,1),document.querySelector("body").prepend(n("delete",e.name)),X())}function X(){let e=0,t=0;console.log(_);for(let n in A)e+=A[n],t+=_[n];P=e,document.querySelector("#cartTotal").innerHTML="Total ("+t+") : "+e+"€"}function D(e,t){const n=e.id;e.setAttribute("id",n+"_"+t)}async function R(e,t){return await function(e,t){!function(e,t){let r=document.querySelector("#modalBox"),o=document.importNode(r.content,!0),c=o.querySelector("#selectedModalBox");D(c,t),c.setAttribute("aria-labelledby","selectedProductTitle_"+t);let i=o.querySelector("#selectedModalTitle");D(i,t),i.innerHTML=e.name;let d=o.querySelector("img");D(d,t),d.setAttribute("src",e.imageUrl),d.setAttribute("alt","Photo du "+e.name);let l=o.querySelector("#modalDescription");D(l,t),l.innerHTML=e.description;let a=o.querySelector("#modalPrice");D(a,t),a.innerHTML=e.price/100+" €";let s=o.querySelector("#labelProductVariant");D(s,t),s.setAttribute("for","productVariant_"+t);let u=o.querySelector("#productVariant");D(u,t),function(e,t){let n=t;for(let t in e){let r=document.createElement("option");r.setAttribute("value",e[t]),r.classList.add("col-12","text-orinoco","text-center","bg-primary"),r.innerHTML=e[t],n.appendChild(r)}}(e.lenses,u);let m=o.querySelector("#addToCartBtn");D(m,t),m.addEventListener("click",(function(){var t;t=e,N.includes(t)?(document.querySelector("body").prepend(n("already",t.name)),setTimeout((function(){$("#cartView").modal("toggle")}),400)):(N.push(t),A.push(parseInt(t.price/100)),_.push(1),O(),document.querySelector("body").prepend(n("add",t.name)),X())})),document.querySelector("main").appendChild(o)}(e,t);let r=document.querySelector("#productCard"),o=document.importNode(r.content,!0),c=o.querySelector("#card");D(c,t);let i=o.querySelector("#cardImg");D(i,t),i.setAttribute("src",e.imageUrl),i.setAttribute("alt","Photo du "+e.name),D(o.querySelector("#cardBody"),t);let d=o.querySelector("#cardName");d.innerHTML=e.name,D(d,t);let l=o.querySelector("#cardShowMore");return D(l,t),l.setAttribute("data-target","#selectedModalBox_"+t),l.setAttribute("aria-controls","selectedModalBox_"+t),c}(e,t)}let Y=document.createEvent("event");Y.initEvent("dataisready",!0,!0);let j=[];(async function(){return(await fetch("https://orinoco-cameras.herokuapp.com/api/cameras")).json()})().then((function(e){e.length>=1&&(j=e,document.dispatchEvent(Y))})).catch((function(e){console.log("ERREUR: \n"+e)}));let U=document.querySelector("#cartToggle"),F=0,z=parseInt(window.screen.height-100),J=U.style.left;window.addEventListener("DOMContentLoaded",(function(e){document.addEventListener("dataisready",(function(){!function(){let e=document.getElementById("deck-cameras");for(let t in j){let n="cameras_"+t;R(j[t],n).then((function(t){e.appendChild(t)})).then((function(){document.getElementById("waiting").classList.add("d-none")})).catch((function(e){console.log("ERREUR: \n"+e)}))}}()})),E(),U.addEventListener("mousedown",(function(e){F=1,U.style.transition="left 0s ease-out"})),document.addEventListener("mousemove",(function(e){1==F&&(parseInt(e.clientX)<parseInt(window.screen.width-120)?U.style.left=parseInt(e.clientX)+"px":U.style.left=parseInt(window.screen.width-120)+"px",parseInt(e.clientY)>0&&(U.style.top=parseInt(e.clientY)+"px"),parseInt(e.clientY)>parseInt(window.screen.height-250)&&(U.style.top=parseInt(window.screen.height-250)+"px"))})),document.addEventListener("mouseup",(function(e){U.style.transition="left 0.5s ease-out",1==F&&(parseInt(e.clientX)<parseInt((window.screen.width-80)/2)?U.style.left="0px":U.style.left=parseInt(window.screen.width-80)+"px"),F=0})),U.addEventListener("touchstart",(function(e){F=1,U.style.transition="left 0s ease-out"}),!1),U.addEventListener("touchend",(function(e){U.style.transition="left 0.5s ease-out",F=0,U.style.left=J+"px"}),!1),U.addEventListener("touchmove",(function(e){e.preventDefault(),1==F&&(parseInt(e.touches[0].clientX)<parseInt(window.screen.width-80)?U.style.left=parseInt(e.touches[0].clientX)+"px":U.style.left=parseInt(window.screen.width-80)+"px",parseInt(e.touches[0].clientX)<0&&(U.style.left="0px"),parseInt(e.touches[0].clientY)>0&&(U.style.top=parseInt(e.touches[0].clientY)+"px"),parseInt(e.touches[0].clientY)>z&&(U.style.top=z+"px"),J=parseInt(e.touches[0].clientX)<parseInt((window.screen.width-80)/2)?0:parseInt(window.screen.width-80),console.log(U.style.left))}),!1)}))})();